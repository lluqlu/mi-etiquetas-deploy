<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Consultas de Env칤os</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
<div class="container">
    <h2>Consultas de Env칤os</h2>

    <form method="post" action="/consultas">
        <label for="codigo">Buscar c칩digo de seguimiento:</label>
        <input type="text" name="codigo" id="codigo" placeholder="Ej: AR-1900-01" required>
        <button type="submit">Buscar</button>
    </form>

    <button onclick="iniciarEscaneo()">游닝 Escanear con C치mara</button>
    <video id="preview" style="width: 100%; max-width: 300px; margin-top: 10px;"></video>

    {% if resultado %}
    <div class="resultado">
        <h3>Resultado:</h3>
        <p><strong>C칩digo:</strong> {{ resultado['Seguimiento'] }}</p>
        <p><strong>Remitente:</strong> {{ resultado['remitente'] }}</p>
        <p><strong>DNI Remitente:</strong> {{ resultado['dni_rem'] }}</p>
        <p><strong>Celular Remitente:</strong> {{ resultado['cel_rem'] }}</p>
        <p><strong>Destinatario:</strong> {{ resultado['destinatario'] }}</p>
        <p><strong>DNI Destinatario:</strong> {{ resultado['dni_dest'] }}</p>
        <p><strong>CP Destino:</strong> {{ resultado['cp_dest'] }}</p>
        <p><strong>Peso:</strong> {{ resultado['peso'] }} kg</p>
        <p><strong>Fr치gil:</strong> {{ resultado['fragil'] }}</p>
        <p><strong>Observaciones:</strong> {{ resultado['observaciones'] }}</p>

        <div class="seguimiento-box">
            <p><strong>Seguimiento:</strong></p>
            <ul>
                {% for evento in eventos %}
                    <li>{{ evento }}</li>
                {% endfor %}
            </ul>

            <form action="/agregar_evento" method="post">
                <input type="hidden" name="codigo" value="{{ codigo }}">
                <label for="evento">Nuevo evento:</label>
                <input type="text" name="evento" id="evento" required>
                <button type="submit">Agregar evento</button>
            </form>
        </div>
    </div>
    {% endif %}
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/instascan/1.0.0/instascan.min.js"></script>
<script>
    function iniciarEscaneo() {
        let scanner = new Instascan.Scanner({ video: document.getElementById('preview') });
        scanner.addListener('scan', function (content) {
            document.getElementById('codigo').value = content;
            document.forms[0].submit();
        });
        Instascan.Camera.getCameras().then(function (cameras) {
            if (cameras.length > 0) {
                scanner.start(cameras[0]);
            } else {
                alert('No se encontr칩 c치mara.');
            }
        }).catch(function (e) {
            console.error(e);
            alert('Error al acceder a la c치mara');
        });
    }
</script>
</body>
</html>


