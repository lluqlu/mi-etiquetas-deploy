<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Consultas de Env칤os</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="container">
        <h2>Consultas de Env칤os</h2>
        <form method="post">
            <input type="text" name="codigo" placeholder="Buscar c칩digo de seguimiento" value="{{ codigo or '' }}" required>
            <button type="submit">Buscar</button>
        </form>

        <button onclick="startScanner()" class="camera-btn">游닝 Escanear con C치mara</button>
        <div id="reader" style="margin-top: 10px;"></div>

        {% if resultado %}
            <div class="resultado">
                <h3>Resultado:</h3>
                <p><strong>C칩digo:</strong> {{ resultado['seguimiento'] }}</p>
                <p><strong>Remitente:</strong> {{ resultado['remitente'] }}</p>
                <p><strong>DNI Remitente:</strong> {{ resultado['dni_rem'] }}</p>
                <p><strong>Celular Remitente:</strong> {{ resultado['cel_rem'] }}</p>
                <p><strong>Direcci칩n Remitente:</strong> {{ resultado['direccion_rem'] }}</p>
                <p><strong>CP:</strong> {{ resultado['cp_rem'] }}</p>
                <p><strong>Ciudad:</strong> {{ resultado['ciudad_rem'] }}</p>
                <p><strong>Provincia:</strong> {{ resultado['prov_rem'] }}</p>
                <hr>
                <p><strong>Destinatario:</strong> {{ resultado['destinatario'] }}</p>
                <p><strong>DNI Destinatario:</strong> {{ resultado['dni_dest'] }}</p>
                <p><strong>Celular Destinatario:</strong> {{ resultado['celular_dest'] }}</p>
                <p><strong>Direcci칩n Destinatario:</strong> {{ resultado['direccion_dest'] }}</p>
                <p><strong>CP:</strong> {{ resultado['cp_dest'] }}</p>
                <p><strong>Ciudad:</strong> {{ resultado['ciudad_dest'] }}</p>
                <p><strong>Provincia:</strong> {{ resultado['prov_dest'] }}</p>
                <p><strong>Peso:</strong> {{ resultado['peso'] }} kg</p>
                <p><strong>Fr치gil:</strong> {{ 'S칤' if resultado['fragil'] else 'No' }}</p>
                <p><strong>Observaciones:</strong> {{ resultado['observaciones'] }}</p>

                <div class="seguimiento-box">
                    <p><strong class="seguimiento-titulo">Seguimiento:</strong></p>
                    <ul>
                        {% for evento in eventos %}
                            <li>{{ evento['fechahora'] }} - {{ evento['evento'] }}</li>
                        {% endfor %}
                    </ul>
                    <form method="post">
                        <input type="hidden" name="codigo" value="{{ resultado['seguimiento'] }}">
                        <input type="text" name="evento" placeholder="Nuevo evento" required>
                        <button type="submit">Agregar evento</button>
                    </form>
                </div>
            </div>
        {% endif %}
    </div>

    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <script>
        function startScanner() {
            const html5QrCode = new Html5Qrcode("reader");
            Html5Qrcode.getCameras().then(devices => {
                if (devices && devices.length) {
                    html5QrCode.start(
                        { facingMode: "environment" },
                        { fps: 10, qrbox: 250 },
                        qrCodeMessage => {
                            document.querySelector("input[name='codigo']").value = qrCodeMessage;
                            html5QrCode.stop().then(() => {
                                document.querySelector("form").submit();
                            });
                        },
                        errorMessage => {}
                    ).catch(err => console.error(err));
                }
            }).catch(err => console.error(err));
        }
    </script>
</body>
</html>


