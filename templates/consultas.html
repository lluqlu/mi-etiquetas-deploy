<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Consultas de Env칤os</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="container">
        <h1>Consultas de Env칤os</h1>

        <form method="POST" action="/consultas">
            <label for="codigo">Buscar c칩digo de seguimiento:</label>
            <input type="text" id="codigo" name="codigo" placeholder="Ej: AR-1900-01" required>
            <button type="submit">Buscar</button>
        </form>

        <button onclick="startScanner()">
            <span class="icon">游닝</span> Escanear con C치mara
        </button>

        <div id="scanner-container" style="display: none;">
            <video id="preview" width="100%"></video>
        </div>

        {% if resultado %}
        <div class="resultado">
            <h3>Resultado:</h3>
            <p><strong>C칩digo:</strong> {{ resultado['Seguimiento'] }}</p>
            <p><strong>Remitente:</strong> {{ resultado['Remitente'] }}</p>
            <p><strong>DNI Remitente:</strong> {{ resultado['DNI Rem'] }}</p>
            <p><strong>Celular Remitente:</strong> {{ resultado['Cel Rem'] }}</p>
            <p><strong>Destinatario:</strong> {{ resultado['Destinatario'] }}</p>
            <p><strong>DNI Destinatario:</strong> {{ resultado['DNI Dest'] }}</p>
            <p><strong>CP Destino:</strong> {{ resultado['CP Dest'] }}</p>
            <p><strong>Peso:</strong> {{ resultado['Peso'] }} kg</p>
            <p><strong>Fr치gil:</strong> {{ resultado['Fr치gil'] }}</p>
            <p><strong>Observaciones:</strong> {{ resultado['Observaciones'] }}</p>

            <div class="seguimiento">
                <h4>Seguimiento:</h4>
                <ul>
                    {% for item in eventos %}
                        <li>{{ item['fechahora'] }} - {{ item['evento'] }}</li>
                    {% endfor %}
                </ul>
                <form method="POST" action="/agregar_evento">
                    <input type="hidden" name="codigo" value="{{ resultado['Seguimiento'] }}">
                    <input type="text" name="evento" placeholder="Nuevo evento" required>
                    <button type="submit">Agregar evento</button>
                </form>
            </div>
        </div>
        {% endif %}

        <script src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>
        <script>
            function startScanner() {
                document.getElementById('scanner-container').style.display = 'block';
                let scanner = new Instascan.Scanner({ video: document.getElementById('preview') });
                scanner.addListener('scan', function (content) {
                    document.getElementById('codigo').value = content;
                    document.forms[0].submit();
                });
                Instascan.Camera.getCameras().then(function (cameras) {
                    if (cameras.length > 0) {
                        scanner.start(cameras[0]);
                    } else {
                        alert('No se encontraron c치maras.');
                    }
                }).catch(function (e) {
                    console.error(e);
                });
            }
        </script>
    </div>
</body>
</html>



